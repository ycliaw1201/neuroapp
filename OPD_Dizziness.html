<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>一般頭暈初診問卷與英文摘要系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', 'Microsoft JhengHei', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .sticky-summary { position: sticky; top: 2rem; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">

    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left: Input Form (8 columns) -->
            <div class="lg:col-span-8 space-y-6">
                <header class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex items-center gap-3 mb-2">
                        <i data-lucide="stethoscope" class="text-blue-600 w-8 h-8"></i>
                        <h1 class="text-2xl font-bold text-slate-900">一般頭暈初診問卷</h1>
                    </div>
                    <p class="text-slate-500">請輸入病患填寫的資料，右側將即時生成英文摘要。</p>
                </header>

                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-slate-200 space-y-8">
                    
                    <!-- 1. Symptom Type -->
                    <section>
                        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <span class="bg-blue-100 text-blue-700 w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span>
                            症狀類型 (最符合的一項)
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="symptom-type-group">
                            <label class="flex items-center p-3 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-50 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                                <input type="radio" name="symptomType" value="lightheadedness" class="mr-3 w-4 h-4 text-blue-600">
                                <span class="text-sm">頭重腳輕 (Lightheadedness)</span>
                            </label>
                            <label class="flex items-center p-3 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-50 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                                <input type="radio" name="symptomType" value="falling" class="mr-3 w-4 h-4 text-blue-600">
                                <span class="text-sm">快跌倒的感覺 (Falling tendency)</span>
                            </label>
                            <label class="flex items-center p-3 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-50 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                                <input type="radio" name="symptomType" value="balance" class="mr-3 w-4 h-4 text-blue-600">
                                <span class="text-sm">走路不平衡 (Loss of balance)</span>
                            </label>
                            <label class="flex items-center p-3 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-50 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                                <input type="radio" name="symptomType" value="externalVertigo" class="mr-3 w-4 h-4 text-blue-600">
                                <span class="text-sm">環境在旋轉 (External vertigo)</span>
                            </label>
                            <label class="flex items-center p-3 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-50 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                                <input type="radio" name="symptomType" value="internalVertigo" class="mr-3 w-4 h-4 text-blue-600">
                                <span class="text-sm">自身在旋轉 (Internal vertigo)</span>
                            </label>
                            <label class="flex items-center p-3 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-50 transition-all has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                                <input type="radio" name="symptomType" value="environmentMoving" class="mr-3 w-4 h-4 text-blue-600">
                                <span class="text-sm">視野晃動 (Environment moving)</span>
                            </label>
                        </div>

                        <!-- Direction Sub-questions -->
                        <div id="direction-sub" class="hidden mt-4 p-4 bg-slate-50 rounded-xl border border-dashed border-slate-300">
                            <p class="text-sm font-medium mb-2">偏向哪一邊？</p>
                            <div class="flex gap-2">
                                <button type="button" onclick="setDirection('前')" class="dir-btn px-4 py-1.5 rounded-full border bg-white text-sm hover:border-blue-500">前</button>
                                <button type="button" onclick="setDirection('後')" class="dir-btn px-4 py-1.5 rounded-full border bg-white text-sm hover:border-blue-500">後</button>
                                <button type="button" onclick="setDirection('左')" class="dir-btn px-4 py-1.5 rounded-full border bg-white text-sm hover:border-blue-500">左</button>
                                <button type="button" onclick="setDirection('右')" class="dir-btn px-4 py-1.5 rounded-full border bg-white text-sm hover:border-blue-500">右</button>
                            </div>
                        </div>
                    </section>

                    <!-- 2. Onset -->
                    <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h2 class="text-lg font-semibold mb-4">2. 第一次發生的時間</h2>
                            <input type="text" id="first-onset" placeholder="如：2023年10月" class="w-full p-3 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold mb-4">這次是第幾次發生？</h2>
                            <input type="number" id="episode-count" placeholder="次數" class="w-full p-3 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        </div>
                    </section>

                    <!-- 3. Frequency & Duration -->
                    <section>
                        <h2 class="text-lg font-semibold mb-4">3. 發生模式與持續時間</h2>
                        <div class="flex gap-6 mb-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="pattern" value="episodic" checked class="mr-2"> 一陣一陣 (Episodic)
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="pattern" value="constant" class="mr-2"> 持續存在 (Constant)
                            </label>
                        </div>
                        <div id="episodic-details" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-slate-600 whitespace-nowrap">每次持續：</span>
                                <input type="text" id="duration-val" class="w-20 p-2 border rounded-lg text-sm">
                                <select id="duration-unit" class="p-2 border rounded-lg text-sm bg-white">
                                    <option value="seconds">秒</option>
                                    <option value="minutes">分</option>
                                    <option value="hours">小時</option>
                                    <option value="days">天</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-slate-600 whitespace-nowrap">頻率：約</span>
                                <input type="text" id="freq-val" class="w-20 p-2 border rounded-lg text-sm">
                                <select id="freq-unit" class="p-2 border rounded-lg text-sm bg-white">
                                    <option value="day">天一次</option>
                                    <option value="week">週一次</option>
                                    <option value="month">月一次</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <!-- 4. Associated Symptoms -->
                    <section>
                        <h2 class="text-lg font-semibold mb-4">4. 伴隨症狀 (複選)</h2>
                        <div class="flex flex-wrap gap-2" id="associated-container">
                            <!-- Buttons populated by JS -->
                        </div>
                    </section>

                    <!-- 5. Triggers -->
                    <section>
                        <h2 class="text-lg font-semibold mb-4">5. 誘發因子 (複選)</h2>
                        <div class="flex flex-wrap gap-2" id="trigger-container">
                            <!-- Buttons populated by JS -->
                        </div>
                    </section>

                    <!-- 6. Better/Worse -->
                    <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h2 class="text-lg font-semibold mb-4">6. 什麼狀況下較好？</h2>
                            <input type="text" id="relieving" placeholder="如：平躺、閉眼" class="w-full p-3 border border-slate-200 rounded-xl text-sm">
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold mb-4">什麼狀況會惡化？</h2>
                            <input type="text" id="aggravating" placeholder="如：轉頭、光線" class="w-full p-3 border border-slate-200 rounded-xl text-sm">
                        </div>
                    </section>

                </div>
            </div>

            <!-- Right: Summary (4 columns) -->
            <div class="lg:col-span-4">
                <div class="sticky-summary space-y-4">
                    <div class="bg-slate-900 rounded-2xl shadow-xl p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-bold flex items-center gap-2">
                                <i data-lucide="file-text" class="w-5 h-5"></i>
                                English Summary
                            </h2>
                            <button onclick="copySummary()" class="flex items-center gap-2 px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded-lg text-xs transition-colors">
                                <i data-lucide="copy" id="copy-icon" class="w-4 h-4"></i>
                                <span id="copy-text">Copy</span>
                            </button>
                        </div>

                        <div id="summary-output" class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 text-sm leading-relaxed min-h-[300px] whitespace-pre-wrap font-mono text-slate-200">
                            Patient presents with dizziness. Initial assessment...
                        </div>

                        <div class="mt-6 pt-6 border-t border-slate-700 space-y-4">
                            <div class="flex items-center justify-between text-[10px] text-slate-500 uppercase tracking-widest">
                                <span>Medical Documenter v1.0</span>
                                <span>Status: Syncing</span>
                            </div>
                            <button onclick="window.location.reload()" class="w-full py-3 bg-red-900/20 hover:bg-red-900/40 text-red-400 border border-red-900/50 rounded-xl text-sm transition-all flex items-center justify-center gap-2">
                                <i data-lucide="trash-2" class="w-4 h-4"></i> 重置所有欄位
                            </button>
                        </div>
                    </div>

                    <div id="copy-message" class="hidden animate-bounce bg-emerald-500 text-white p-3 rounded-xl text-center text-sm font-medium">
                        ✓ 已成功複製到剪貼簿！
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // State Management
        let state = {
            symptomType: '',
            direction: '',
            firstOnset: '',
            episodeCount: '',
            pattern: 'episodic',
            durationVal: '',
            durationUnit: 'minutes',
            freqVal: '',
            freqUnit: 'month',
            associated: [],
            triggers: [],
            relieving: '',
            aggravating: ''
        };

        const symptomMap = {
            lightheadedness: 'Lightheadedness',
            falling: 'Falling tendency',
            balance: 'Loss of balance',
            externalVertigo: 'External vertigo',
            internalVertigo: 'Internal vertigo',
            environmentMoving: 'Oscillopsia (Environment moving)'
        };

        const associatedOptions = [
            { zh: '複視', en: 'Diplopia' }, { zh: '失去意識', en: 'Loss of consciousness' },
            { zh: '視力模糊', en: 'Blurred vision' }, { zh: '頭痛', en: 'Headache' },
            { zh: '噁心', en: 'Nausea' }, { zh: '嘔吐', en: 'Vomiting' },
            { zh: '胸悶', en: 'Chest tightness' }, { zh: '胸痛', en: 'Chest pain' },
            { zh: '心悸', en: 'Palpitations' }, { zh: '手腳麻', en: 'Numbness' },
            { zh: '手腳無力', en: 'Weakness' }, { zh: '聽力下降', en: 'Hearing loss' },
            { zh: '耳鳴', en: 'Tinnitus' }
        ];

        const triggerOptions = [
            { zh: '姿勢變化(躺下)', en: 'Positional (lying down)' },
            { zh: '姿勢變化(起身)', en: 'Positional (standing up)' },
            { zh: '姿勢變化(轉頭)', en: 'Positional (head turning)' },
            { zh: '用力', en: 'Valsalva maneuver' },
            { zh: '搭飛機', en: 'Air travel' },
            { zh: '潛水', en: 'Diving' },
            { zh: '感冒發燒', en: 'Common cold/fever' }
        ];

        // Initialize UI
        function init() {
            lucide.createIcons();
            renderCheckboxes('associated-container', associatedOptions, 'associated');
            renderCheckboxes('trigger-container', triggerOptions, 'triggers');
            setupEventListeners();
            updateSummary();
        }

        function renderCheckboxes(containerId, options, stateKey) {
            const container = document.getElementById(containerId);
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'px-3 py-2 rounded-xl border border-slate-200 text-sm bg-white transition-all hover:bg-slate-50';
                btn.innerText = opt.zh;
                btn.onclick = () => {
                    const index = state[stateKey].indexOf(opt.en);
                    if (index > -1) {
                        state[stateKey].splice(index, 1);
                        btn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                    } else {
                        state[stateKey].push(opt.en);
                        btn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                    }
                    updateSummary();
                };
                container.appendChild(btn);
            });
        }

        function setupEventListeners() {
            // Symptom Type
            document.querySelectorAll('input[name="symptomType"]').forEach(input => {
                input.onchange = (e) => {
                    state.symptomType = e.target.value;
                    document.getElementById('direction-sub').classList.toggle('hidden', !['falling', 'balance'].includes(state.symptomType));
                    updateSummary();
                };
            });

            // Pattern
            document.querySelectorAll('input[name="pattern"]').forEach(input => {
                input.onchange = (e) => {
                    state.pattern = e.target.value;
                    document.getElementById('episodic-details').classList.toggle('hidden', state.pattern === 'constant');
                    updateSummary();
                };
            });

            // Text Inputs
            ['first-onset', 'episode-count', 'duration-val', 'freq-val', 'relieving', 'aggravating'].forEach(id => {
                const key = id.replace(/-([a-z])/g, (g) => g[1].toUpperCase()).replace('Val', 'Val');
                const field = document.getElementById(id);
                field.oninput = (e) => {
                    // map id to state key manually to avoid mismatch
                    if(id === 'first-onset') state.firstOnset = e.target.value;
                    if(id === 'episode-count') state.episodeCount = e.target.value;
                    if(id === 'duration-val') state.durationVal = e.target.value;
                    if(id === 'freq-val') state.freqVal = e.target.value;
                    if(id === 'relieving') state.relieving = e.target.value;
                    if(id === 'aggravating') state.aggravating = e.target.value;
                    updateSummary();
                };
            });

            // Selects
            document.getElementById('duration-unit').onchange = (e) => { state.durationUnit = e.target.value; updateSummary(); };
            document.getElementById('freq-unit').onchange = (e) => { state.freqUnit = e.target.value; updateSummary(); };
        }

        function setDirection(d) {
            state.direction = d;
            document.querySelectorAll('.dir-btn').forEach(btn => {
                btn.classList.toggle('bg-blue-600', btn.innerText === d);
                btn.classList.toggle('text-white', btn.innerText === d);
            });
            updateSummary();
        }

        function updateSummary() {
            let summary = "Patient presents with dizziness. ";

            if (state.symptomType) {
                summary += `Primary symptom is described as ${symptomMap[state.symptomType]}. `;
                if (['falling', 'balance'].includes(state.symptomType) && state.direction) {
                    const dMap = {'前':'forward', '後':'backward', '左':'to the left', '右':'to the right'};
                    summary += `(Tends to lean ${dMap[state.direction] || state.direction}). `;
                }
            }

            summary += `Onset: ${state.firstOnset || '[Not specified]'}. Current episode count: ${state.episodeCount || '1'}. `;
            summary += `The condition is ${state.pattern}. `;

            if (state.pattern === 'episodic' && state.durationVal) {
                summary += `Each episode lasts approx. ${state.durationVal} ${state.durationUnit}. `;
                if (state.freqVal) {
                    summary += `Frequency: ~${state.freqVal} per ${state.freqUnit}. `;
                }
            }

            if (state.associated.length > 0) {
                summary += `Associated symptoms include: ${state.associated.join(', ')}. `;
            }

            if (state.triggers.length > 0) {
                summary += `Triggered by: ${state.triggers.join(', ')}. `;
            }

            if (state.relieving) summary += `Relieved by: ${state.relieving}. `;
            if (state.aggravating) summary += `Aggravated by: ${state.aggravating}. `;

            document.getElementById('summary-output').innerText = summary;
        }

        function copySummary() {
            const text = document.getElementById('summary-output').innerText;
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            // UI Feedback
            const msg = document.getElementById('copy-message');
            msg.classList.remove('hidden');
            setTimeout(() => msg.classList.add('hidden'), 2000);
        }

        window.onload = init;
    </script>
</body>
</html>
